

<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Talkity talk by Lucas Roesler">
    <meta property="og:title" content="Easy settings management for Python functions with Pydantic" />
<meta property="og:description" content="File this under quick tips and tricks for Python functions in OpenFaas.
I just learned about Pydantic&rsquo;s support for reading settings from secret files and it fits perfectly with secrets in OpenFaaS. If you love Python or you are writing Python functions in OpenFaas, this is a great way to simplify your configuration parsing.
I am going to keep this short and sweet. Let&rsquo;s say you have an OpenFaas function that needs to access a database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lucasroesler.com/posts/2021/pydantic-settings-for-openfaas-functions/" />
<meta property="article:published_time" content="2021-08-03T00:00:00+02:00" />
<meta property="article:modified_time" content="2021-08-03T00:00:00+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Easy settings management for Python functions with Pydantic"/>
<meta name="twitter:description" content="File this under quick tips and tricks for Python functions in OpenFaas.
I just learned about Pydantic&rsquo;s support for reading settings from secret files and it fits perfectly with secrets in OpenFaaS. If you love Python or you are writing Python functions in OpenFaas, this is a great way to simplify your configuration parsing.
I am going to keep this short and sweet. Let&rsquo;s say you have an OpenFaas function that needs to access a database."/>

<meta property="og:title" content="Easy settings management for Python functions with Pydantic" />
<meta property="og:description" content="File this under quick tips and tricks for Python functions in OpenFaas.
I just learned about Pydantic&rsquo;s support for reading settings from secret files and it fits perfectly with secrets in OpenFaaS. If you love Python or you are writing Python functions in OpenFaas, this is a great way to simplify your configuration parsing.
I am going to keep this short and sweet. Let&rsquo;s say you have an OpenFaas function that needs to access a database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lucasroesler.com/posts/2021/pydantic-settings-for-openfaas-functions/" />
<meta property="article:published_time" content="2021-08-03T00:00:00+02:00" />
<meta property="article:modified_time" content="2021-08-03T00:00:00+02:00" />

<meta itemprop="name" content="Easy settings management for Python functions with Pydantic">
<meta itemprop="description" content="File this under quick tips and tricks for Python functions in OpenFaas.
I just learned about Pydantic&rsquo;s support for reading settings from secret files and it fits perfectly with secrets in OpenFaaS. If you love Python or you are writing Python functions in OpenFaas, this is a great way to simplify your configuration parsing.
I am going to keep this short and sweet. Let&rsquo;s say you have an OpenFaas function that needs to access a database.">
<meta itemprop="datePublished" content="2021-08-03T00:00:00+02:00" />
<meta itemprop="dateModified" content="2021-08-03T00:00:00+02:00" />
<meta itemprop="wordCount" content="287">



<meta itemprop="keywords" content="programming,openfaas,python,secrets,pydantic," />



    <title>
        Easy settings management for Python functions with Pydantic &middot; Lucas Roesler
    </title>
    <link rel="canonical" href="https://lucasroesler.com/posts/2021/pydantic-settings-for-openfaas-functions/">

    
    <link rel="stylesheet" href="https://lucasroesler.com/css/posts.style.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    </head>
<body class="article">
    <main>
        <section class="cover">
            <div role="img" class="cover-img" style="
                background: radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 24%, rgba(0,0,0,0.65) 100%), url(/images/topography.svg) no-repeat center center scroll;
                background-color: #333745;">
                <h1>Easy settings management for Python functions with Pydantic</h1>
            </div>
            <div class="nav--mini">
                <a class="btn .btn--default btn--nav" href="https://lucasroesler.com/">
                    <icon class="nav-icon fas fa-home"></icon>
                </a>
                <a class="btn .btn--default btn--nav" href="https://lucasroesler.com/posts/">
                    <icon class="nav-icon fas fa-rss"></icon>
                </a>
            </div>
        </section>
        <article class=" post" itemscope itemType="http://schema.org/BlogPosting">
            <div class="post-content markdown" itemprop="articleBody">
                <div class="main-content-wrap">
                    <p>File this under quick tips and tricks for Python functions in OpenFaas.</p>
<p>I just learned about <a href="https://pydantic-docs.helpmanual.io/">Pydantic&rsquo;s</a> support for <a href="https://pydantic-docs.helpmanual.io/usage/settings/#secret-support">reading settings from secret files</a> and it fits perfectly with secrets in OpenFaaS. If you love Python or you are writing Python functions in OpenFaas, this is a great way to simplify your configuration parsing.</p>
<!-- raw HTML omitted -->
<p>I am going to keep this short and sweet. Let&rsquo;s say you have an OpenFaas function that needs to access a database. Typically, this requires the <code>db_host</code>, <code>db_user</code>, and <code>db_password</code> to be configured. In OpenFaas, we would expect the <code>db_host</code> and <code>db_user</code> as environment variables, but the <code>db_password</code> is sensitive and should be supplied as a secret, see <a href="https://docs.openfaas.com/reference/secrets/">the docs for a quick intro to secrets</a>.</p>
<p>Your function <code>stack.yaml</code> might look like this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  <span style="color:#f92672">functions</span>:
    <span style="color:#f92672">cool_function</span>:
      <span style="color:#f92672">lang</span>: <span style="color:#ae81ff">python3</span>
      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">functions/cool_function:latest</span>
      <span style="color:#f92672">env</span>:
        <span style="color:#f92672">db_host</span>: <span style="color:#ae81ff">cool.rds.aws.com</span>
        <span style="color:#f92672">db_user</span>: <span style="color:#ae81ff">super_cool_person</span>
      <span style="color:#f92672">secrets</span>:
      - <span style="color:#ae81ff">db_password</span>
</code></pre></div><p>If you use <code>pydantic</code>, then the only code you need for to configure your function looks like this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">from</span> pydantic <span style="color:#f92672">import</span> BaseSettings
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Settings</span>(BaseSettings):
    db_password: str
    db_host: str
    db_user: str

    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Config</span>:
        secrets_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/var/openfaas/secrets&#39;</span>

settings <span style="color:#f92672">=</span> Settings()
</code></pre></div><p>When <code>Settings</code> is instantiated, it will automatically read the values from the environment variables <em>and</em> from our secrets, because we set <code>secrets_dir</code>. Given our <code>stack.yaml</code> above, this means</p>
<ul>
<li><code>settings.db_host == cool.rds.aws.com</code>,</li>
<li><code>db_user == super_cool_person</code>, and</li>
<li><code>db_password</code> will be the value from <code>/var/openfaas/secrets/db_password</code>,</li>
</ul>
<p>because OpenFaaS puts all of the secrets into <code>/var/openfaas/secrets</code>.</p>
<p>That&rsquo;s it, 10 lines of code and you get simple type safe configuration.</p>
<h2 id="next-steps">Next steps</h2>
<p>I am a big fan of type hinting in Python. Once, you are using Pydantic, then the next step is to configure <a href="http://mypy-lang.org/"><code>mypy</code></a> to get static type checking before you deploy your functions. But that is a blog post for another day.</p>

                </div>
            </div>
            <div id="post-footer" class="post-footer post-content">
                
                <div class="post-footer-tags">
                    <span class="text-color-light text-small"></span><br />
                    
                    <a class="tag tag--small" href="https://lucasroesler.com/tags/programming/">programming</a>
                    
                    <a class="tag tag--small" href="https://lucasroesler.com/tags/openfaas/">openfaas</a>
                    
                    <a class="tag tag--small" href="https://lucasroesler.com/tags/python/">python</a>
                    
                    <a class="tag tag--small" href="https://lucasroesler.com/tags/secrets/">secrets</a>
                    
                    <a class="tag tag--small" href="https://lucasroesler.com/tags/pydantic/">pydantic</a>
                    
                </div>
                
            </div>
        </article>
        <footer>
    <span class="copyrights">
        Made with <a href='https://gohugo.io'>Hugo</a><br/>
        &copy; 2017 - 2021 by Lucas Roesler.  - <a href="https://lucasroesler.com/posts/index.xml">RSS</a>
    </span>
</footer>

    </main>
</body>

</html>
